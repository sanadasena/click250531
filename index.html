<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>クリックで強くなるゲーム</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }
        .game-container {
            background-color: #ffffff;
            border-radius: 1.5rem; /* rounded-3xl */
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1); /* shadow-xl */
            padding: 2rem;
            text-align: center;
            width: 100%;
            max-width: 600px;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        .btn {
            padding: 1rem 2rem;
            border-radius: 0.75rem; /* rounded-xl */
            font-weight: 700; /* font-bold */
            transition: all 0.2s ease-in-out;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            display: inline-flex;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
        }
        .btn-primary {
            background-image: linear-gradient(to right, #6366f1, #8b5cf6); /* from-indigo-500 to-purple-600 */
            color: white;
        }
        .btn-primary:hover {
            background-image: linear-gradient(to right, #4f46e5, #7c3aed); /* from-indigo-600 to-purple-700 */
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }
        .btn-secondary {
            background-color: #e2e8f0; /* bg-slate-200 */
            color: #334155; /* text-slate-700 */
        }
        .btn-secondary:hover {
            background-color: #cbd5e1; /* bg-slate-300 */
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }
        .btn-premium {
            background-image: linear-gradient(to right, #f59e0b, #ef4444); /* from-amber-500 to-red-500 */
            color: white;
        }
        .btn-premium:hover {
            background-image: linear-gradient(to right, #d97706, #dc2626); /* from-amber-600 to-red-600 */
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }
        .btn-gacha {
            background-image: linear-gradient(to right, #10b981, #06b6d4); /* from-emerald-500 to-cyan-500 */
            color: white;
        }
        .btn-gacha:hover {
            background-image: linear-gradient(to right, #059669, #0891b2); /* from-emerald-600 to-cyan-600 */
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }
        .upgrade-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #f8fafc; /* bg-slate-50 */
            padding: 1rem;
            border-radius: 0.75rem; /* rounded-xl */
            border: 1px solid #e2e8f0; /* border-slate-200 */
        }
        .upgrade-item button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .message-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #333;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            pointer-events: none; /* Allows clicks to pass through */
        }
        .message-box.show {
            opacity: 1;
        }
        .character-list {
            max-height: 150px; /* Adjust as needed */
            overflow-y: auto;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            padding: 0.5rem;
            background-color: #f8fafc;
        }
        .character-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid #e2e8f0;
        }
        .character-item:last-child {
            border-bottom: none;
        }

        /* --- エフェクト関連のCSS --- */
        #effectContainer {
            position: fixed; /* 画面全体に固定 */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none; /* クリックイベントを透過させる */
            overflow: hidden; /* 画面外に出たエフェクトを非表示 */
            z-index: 999; /* 他の要素の上に表示 */
        }

        .particle {
            position: absolute;
            border-radius: 50%; /* 円形 */
            opacity: 0;
            transform: translate(-50%, -50%) scale(0); /* 初期状態は中央に小さく */
            animation: particle-fade-move 1s forwards ease-out; /* アニメーション */
        }

        /* エフェクトのアニメーション定義 */
        @keyframes particle-fade-move {
            0% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(0); /* 初期は透明で小さい */
            }
            50% {
                opacity: 0.8;
                transform: translate(var(--translate-x), var(--translate-y)) scale(1); /* 中間で少し移動し拡大 */
            }
            100% {
                opacity: 0;
                transform: translate(var(--translate-x), var(--translate-y)) scale(1.5); /* 最終的に透明になりさらに拡大 */
            }
        }
        /* --- エフェクト関連のCSS終 --- */

        /* Responsive adjustments */
        @media (max-width: 640px) {
            .game-container {
                padding: 1.5rem;
            }
            .btn {
                padding: 0.75rem 1.5rem;
                font-size: 0.9rem;
            }
            .upgrade-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }
            .upgrade-item button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1 class="text-4xl font-extrabold text-gray-900 mb-4">クリックで強くなるゲーム</h1>

        <div class="bg-blue-100 text-blue-800 p-3 rounded-lg mb-4 font-semibold text-lg">
            ページを開いてからの時間: <span id="elapsedTimeDisplay">0日0時間0分0秒,000秒</span>
        </div>

        <div class="flex flex-col md:flex-row justify-around items-center gap-4 text-xl font-semibold text-gray-700">
            <p>現在の力: <span id="powerDisplay" class="text-indigo-600 text-3xl">0</span></p>
            <p>プレミアム通貨: <span id="premiumCurrencyDisplay" class="text-amber-500 text-3xl">0</span></p>
            <p>現在のクリック力: <span id="currentClickPowerDisplay" class="text-purple-600 text-3xl">1</span></p>
        </div>

        <button id="clickButton" class="btn btn-primary text-2xl mt-4">
            <span class="mr-2">💪</span> クリックして力を得る！
        </button>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6">
            <div class="col-span-full text-2xl font-bold text-gray-800 mb-2">アップグレード</div>

            <div class="upgrade-item">
                <div>
                    <p class="font-bold text-lg">クリック力強化</p>
                    <p class="text-sm text-gray-600">クリックあたりの力が<span id="clickPowerUpgradeValue">1</span>増加</p>
                    <p class="text-sm text-gray-600">コスト: <span id="clickPowerUpgradeCost">10</span> 力</p>
                </div>
                <button id="buyClickPowerUpgrade" class="btn btn-secondary text-base">購入</button>
            </div>

            <div class="upgrade-item">
                <div>
                    <p class="font-bold text-lg">自動クリック</p>
                    <p class="text-sm text-gray-600">毎秒<span id="autoClickValue">0</span>の力を自動獲得</p>
                    <p class="text-sm text-gray-600">コスト: <span id="autoClickCost">100</span> 力</p>
                </div>
                <button id="buyAutoClickUpgrade" class="btn btn-secondary text-base">購入</button>
            </div>
        </div>

        <div class="mt-6">
            <div class="col-span-full text-2xl font-bold text-gray-800 mb-2">ガチャ</div>
            <div class="upgrade-item">
                <div>
                    <p class="font-bold text-lg">キャラガチャ</p>
                    <p class="text-sm text-gray-600">新しいキャラクターをゲット！</p>
                    <p class="text-sm text-gray-600">コスト: <span id="gachaCost">500</span> 力</p>
                </div>
                <button id="drawGacha" class="btn btn-gacha text-base">ガチャを引く</button>
            </div>
            <div class="mt-4">
                <p class="text-lg font-semibold text-gray-800">所持キャラクター:</p>
                <div id="ownedCharactersList" class="character-list">
                    <p class="text-gray-500 text-sm italic">まだキャラクターがいません。</p>
                </div>
            </div>
        </div>

        <div class="mt-6">
            <div class="col-span-full text-2xl font-bold text-gray-800 mb-2">課金要素</div>
            <div class="upgrade-item">
                <div>
                    <p class="font-bold text-lg">プレミアム通貨購入</p>
                    <p class="text-sm text-gray-600">100 プレミアム通貨を獲得</p>
                    <p class="text-sm text-gray-600">（シミュレーション）</p>
                </div>
                <button id="buyPremiumCurrency" class="btn btn-premium text-base">購入する</button>
            </div>

            <div class="upgrade-item mt-4">
                <div>
                    <p class="font-bold text-lg">究極の力</p>
                    <p class="text-sm text-gray-600">クリックあたりの力が<span id="ultimatePowerValue">1000</span>増加</p>
                    <p class="text-sm text-gray-600">コスト: <span id="ultimatePowerCost">50</span> プレミアム通貨</p>
                </div>
                <button id="buyUltimatePower" class="btn btn-premium text-base">購入</button>
            </div>
        </div>
    </div>

    <div id="messageBox" class="message-box"></div>
    <div id="effectContainer"></div>

    <script>
        // ゲームの状態変数
        let power = 0; // 現在の力
        let premiumCurrency = 0; // プレミアム通貨
        let baseClickPower = 1; // 基本のクリック力
        let autoClickRate = 0; // 自動クリックで毎秒獲得する力
        let ownedCharacters = []; // 所持キャラクターのリスト。各キャラは { id, name, attack, rarity, multiplier } を持つ

        // キャラクターデータ (ベースステータス)
        const characters = [
            { id: 'char1', name: '見習い剣士', attack: 5, rarity: 'Common' },
            { id: 'char2', name: '見習い魔法使い', attack: 7, rarity: 'Common' },
            { id: 'char3', name: '熟練の戦士', attack: 15, rarity: 'Uncommon' },
            { id: 'char4', name: '癒しの僧侶', attack: 3, rarity: 'Uncommon' },
            { id: 'char5', name: '伝説のドラゴン', attack: 50, rarity: 'Rare' },
            { id: 'char6', name: '影の暗殺者', attack: 25, rarity: 'Rare' },
            { id: 'char7', name: '聖なる騎士', attack: 30, rarity: 'Rare' },
            { id: 'char8', name: '古代の賢者', attack: 40, rarity: 'Rare' }
        ];

        // アップグレードのコストと効果
        const upgrades = {
            clickPower: {
                cost: 10,
                effect: 1,
                level: 0
            },
            autoClick: {
                cost: 100,
                effect: 1,
                level: 0
            },
            ultimatePower: {
                cost: 50, // プレミアム通貨でのコスト
                effect: 1000,
                level: 0
            }
        };

        // ガチャのコスト
        const gachaCost = 500;
        const GACHA_DUPLICATE_MULTIPLIER_BONUS = 0.1; // 同じキャラを引いた時の攻撃力倍率増加量

        // DOM要素の取得
        const powerDisplay = document.getElementById('powerDisplay');
        const premiumCurrencyDisplay = document.getElementById('premiumCurrencyDisplay');
        const currentClickPowerDisplay = document.getElementById('currentClickPowerDisplay'); // 現在のクリック力表示
        const clickButton = document.getElementById('clickButton');
        const messageBox = document.getElementById('messageBox');
        const effectContainer = document.getElementById('effectContainer'); // エフェクトコンテナ
        const elapsedTimeDisplay = document.getElementById('elapsedTimeDisplay'); // 経過時間表示要素

        // アップグレードボタンと表示要素
        const buyClickPowerUpgradeBtn = document.getElementById('buyClickPowerUpgrade');
        const clickPowerUpgradeCostDisplay = document.getElementById('clickPowerUpgradeCost');
        const clickPowerUpgradeValueDisplay = document.getElementById('clickPowerUpgradeValue');

        const buyAutoClickUpgradeBtn = document.getElementById('buyAutoClickUpgrade');
        const autoClickCostDisplay = document.getElementById('autoClickCost');
        const autoClickValueDisplay = document.getElementById('autoClickValue');

        const buyPremiumCurrencyBtn = document.getElementById('buyPremiumCurrency');

        const buyUltimatePowerBtn = document.getElementById('buyUltimatePower');
        const ultimatePowerCostDisplay = document.getElementById('ultimatePowerCost');
        const ultimatePowerValueDisplay = document.getElementById('ultimatePowerValue');

        // ガチャ関連DOM要素
        const drawGachaBtn = document.getElementById('drawGacha');
        const gachaCostDisplay = document.getElementById('gachaCost');
        const ownedCharactersList = document.getElementById('ownedCharactersList');

        // エフェクト用のカラーパレット
        const particleColors = [
            ['#FFD700', '#FFA500'], // Gold to Orange
            ['#8A2BE2', '#4B0082'], // Blue Violet to Indigo
            ['#00CED1', '#40E0D0'], // Dark Turquoise to Turquoise
            ['#FF69B4', '#FF1493'], // Hot Pink to Deep Pink
            ['#7FFF00', '#32CD32']  // Chartreuse to Lime Green
        ];

        // ページを開いた時刻
        const startTime = Date.now();

        /**
         * 現在の総クリック力を計算する関数
         * baseClickPower、アップグレード、所持キャラクターの攻撃力を合計します。
         */
        function calculateTotalClickPower() {
            let total = baseClickPower;

            // クリック力強化アップグレードによる加算
            total += upgrades.clickPower.level * upgrades.clickPower.effect;

            // 究極の力アップグレードによる加算
            total += upgrades.ultimatePower.level * upgrades.ultimatePower.effect;

            // 所持キャラクターの攻撃力と倍率による加算
            ownedCharacters.forEach(char => {
                total += char.attack * char.multiplier;
            });

            return Math.ceil(total); // 小数点以下を切り上げて整数にする
        }

        // UIを更新する関数
        function updateUI() {
            powerDisplay.textContent = power.toLocaleString();
            premiumCurrencyDisplay.textContent = premiumCurrency.toLocaleString();
            currentClickPowerDisplay.textContent = calculateTotalClickPower().toLocaleString(); // 計算したクリック力を表示

            // クリック力強化の表示更新
            clickPowerUpgradeCostDisplay.textContent = upgrades.clickPower.cost.toLocaleString();
            clickPowerUpgradeValueDisplay.textContent = upgrades.clickPower.effect.toLocaleString();
            buyClickPowerUpgradeBtn.disabled = power < upgrades.clickPower.cost;

            // 自動クリックの表示更新
            autoClickCostDisplay.textContent = upgrades.autoClick.cost.toLocaleString();
            autoClickValueDisplay.textContent = autoClickRate.toLocaleString();
            buyAutoClickUpgradeBtn.disabled = power < upgrades.autoClick.cost;

            // 究極の力の表示更新
            ultimatePowerCostDisplay.textContent = upgrades.ultimatePower.cost.toLocaleString();
            ultimatePowerValueDisplay.textContent = upgrades.ultimatePower.effect.toLocaleString();
            buyUltimatePowerBtn.disabled = premiumCurrency < upgrades.ultimatePower.cost;

            // ガチャの表示更新
            gachaCostDisplay.textContent = gachaCost.toLocaleString();
            drawGachaBtn.disabled = power < gachaCost;

            // 所持キャラクターリストの更新
            ownedCharactersList.innerHTML = ''; // リストをクリア
            if (ownedCharacters.length === 0) {
                ownedCharactersList.innerHTML = '<p class="text-gray-500 text-sm italic">まだキャラクターがいません。</p>';
            } else {
                ownedCharacters.forEach(char => {
                    const charItem = document.createElement('div');
                    charItem.className = 'character-item';
                    let multiplierText = '';
                    if (char.multiplier > 1) {
                        multiplierText = ` (x${char.multiplier.toFixed(1)}倍)`; // 倍率を表示
                    }
                    // キャラクターの攻撃力表示を、倍率を反映して切り上げた値にする
                    const displayedAttack = Math.ceil(char.attack * char.multiplier);
                    charItem.innerHTML = `
                        <span class="font-medium">${char.name}</span>
                        <span class="text-sm text-gray-600">攻撃力: ${displayedAttack}${multiplierText}</span>
                    `;
                    ownedCharactersList.appendChild(charItem);
                });
            }
        }

        // メッセージボックスを表示する関数
        function showMessage(message, duration = 2000) {
            messageBox.textContent = message;
            messageBox.classList.add('show');
            setTimeout(() => {
                messageBox.classList.remove('show');
            }, duration);
        }

        // クリックエフェクトを生成する関数
        function createClickEffect(x, y) {
            const numParticles = 5 + Math.floor(Math.random() * 5); // 5-9個の粒子
            for (let i = 0; i < numParticles; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';

                // ランダムなサイズ
                const size = 10 + Math.random() * 20; // 10pxから30px
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;

                // ランダムな色
                const colors = particleColors[Math.floor(Math.random() * particleColors.length)];
                particle.style.background = `radial-gradient(circle, ${colors[0]} 0%, ${colors[1]} 100%)`;

                // クリック位置に配置
                particle.style.left = `${x}px`;
                particle.style.top = `${y}px`;

                // ランダムな移動量 (CSS変数でアニメーションに渡す)
                const translateX = (Math.random() - 0.5) * 100; // -50pxから50px
                const translateY = (Math.random() - 0.5) * 100; // -50pxから50px
                particle.style.setProperty('--translate-x', `${translateX}px`);
                particle.style.setProperty('--translate-y', `${translateY}px`);

                // アニメーションの遅延と持続時間を少しランダムにする
                const animationDuration = 0.8 + Math.random() * 0.4; // 0.8sから1.2s
                particle.style.animationDuration = `${animationDuration}s`;
                const animationDelay = Math.random() * 0.2; // 0sから0.2s
                particle.style.animationDelay = `${animationDelay}s`;


                effectContainer.appendChild(particle);

                // アニメーション終了後に要素を削除
                particle.addEventListener('animationend', () => {
                    particle.remove();
                });
            }
        }

        // 経過時間を更新する関数
        function updateElapsedTime() {
            const now = Date.now();
            const elapsedMilliseconds = now - startTime;

            const ms = elapsedMilliseconds % 1000;
            const totalSeconds = Math.floor(elapsedMilliseconds / 1000);
            const seconds = totalSeconds % 60;
            const totalMinutes = Math.floor(totalSeconds / 60);
            const minutes = totalMinutes % 60;
            const totalHours = Math.floor(totalMinutes / 60);
            const hours = totalHours % 24;
            const days = Math.floor(totalHours / 24);

            // ミリ秒を3桁にフォーマット
            const formattedMs = String(ms).padStart(3, '0');

            elapsedTimeDisplay.textContent = `${days}日${hours}時間${minutes}分${seconds}秒,${formattedMs}秒`;
        }

        // クリックボタンのイベントリスナー
        clickButton.addEventListener('click', (event) => {
            power += calculateTotalClickPower(); // 計算したクリック力を使用
            updateUI();
            showMessage(`+${calculateTotalClickPower()} 力！`); // メッセージも計算したクリック力で表示

            // クリックエフェクトを生成
            createClickEffect(event.clientX, event.clientY);
        });

        // クリック力強化の購入
        buyClickPowerUpgradeBtn.addEventListener('click', () => {
            if (power >= upgrades.clickPower.cost) {
                power -= upgrades.clickPower.cost;
                upgrades.clickPower.level++; // レベルを上げる
                upgrades.clickPower.cost = Math.floor(upgrades.clickPower.cost * 1.5); // コスト増加
                showMessage(`クリック力強化！`);
                updateUI(); // UI更新時にクリック力が再計算される
            } else {
                showMessage('力が足りません！');
            }
        });

        // 自動クリックの購入
        buyAutoClickUpgradeBtn.addEventListener('click', () => {
            if (power >= upgrades.autoClick.cost) {
                power -= upgrades.autoClick.cost;
                autoClickRate += upgrades.autoClick.effect;
                upgrades.autoClick.cost = Math.floor(upgrades.autoClick.cost * 1.8); // コスト増加
                upgrades.autoClick.level++;
                showMessage(`自動クリック購入！ 毎秒 ${autoClickRate} 力獲得！`);
                updateUI();
            } else {
                showMessage('力が足りません！');
            }
        });

        // プレミアム通貨の購入（シミュレーション）
        buyPremiumCurrencyBtn.addEventListener('click', () => {
            premiumCurrency += 100; // 100プレミアム通貨を付与
            showMessage('プレミアム通貨を100購入しました！');
            updateUI();
        });

        // 究極の力の購入
        buyUltimatePowerBtn.addEventListener('click', () => {
            if (premiumCurrency >= upgrades.ultimatePower.cost) {
                premiumCurrency -= upgrades.ultimatePower.cost;
                upgrades.ultimatePower.level++; // レベルを上げる
                // 究極の力は一度しか買えない、またはコストが急増するなど、調整が必要
                // ここではシンプルにレベルを上げるだけ
                showMessage(`究極の力を手に入れた！`);
                updateUI(); // UI更新時にクリック力が再計算される
            } else {
                showMessage('プレミアム通貨が足りません！');
            }
        });

        // ガチャを引く
        drawGachaBtn.addEventListener('click', () => {
            if (power >= gachaCost) {
                power -= gachaCost;

                // ランダムにキャラクターを選択
                const randomIndex = Math.floor(Math.random() * characters.length);
                const newCharacterBase = characters[randomIndex]; // ベースデータ

                // 所持キャラクターの中に同じIDのキャラクターがいるかチェック
                let existingChar = ownedCharacters.find(char => char.id === newCharacterBase.id);

                if (existingChar) {
                    // 同じキャラクターがいた場合、倍率を上げる
                    existingChar.multiplier = parseFloat((existingChar.multiplier + GACHA_DUPLICATE_MULTIPLIER_BONUS).toFixed(1));
                    showMessage(`${existingChar.name} の攻撃力が x${existingChar.multiplier.toFixed(1)}倍 になりました！`);
                } else {
                    // 新しいキャラクターの場合、リストに追加
                    const newOwnedChar = { ...newCharacterBase, multiplier: 1.0 }; // 新しいインスタンスとして倍率1.0で追加
                    ownedCharacters.push(newOwnedChar);
                    showMessage(`${newCharacterBase.name} を獲得しました！ (攻撃力: ${newCharacterBase.attack})`);
                }
                updateUI(); // UI更新時にクリック力が再計算される
            } else {
                showMessage(`ガチャを引くには ${gachaCost} 力が必要です！`);
            }
        });

        // 自動クリックのタイマー
        setInterval(() => {
            power += autoClickRate;
            updateUI();
        }, 1000); // 1秒ごとに実行

        // 経過時間カウンターのタイマー (10ミリ秒ごとに更新)
        setInterval(updateElapsedTime, 10);

        // 初期UIの更新
        updateUI();
        // ページロード時に一度経過時間を更新
        updateElapsedTime();
    </script>
</body>
</html>
